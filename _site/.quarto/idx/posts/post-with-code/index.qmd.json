{"title":"A Beginner’s Guide to Climate Data Analysis with Python: NetCDF, xarray","markdown":{"yaml":{"title":"A Beginner’s Guide to Climate Data Analysis with Python: NetCDF, xarray","author":"Min Sothearith","date":"2025-03-15","categories":["Climate Data"],"image":"image.webp"},"headingText":"**Introduction to Climate Data**","containsRefs":false,"markdown":"\n\nWith the evolution of computational technology, climate studies have greatly benefited from these advancements. In the past, analyzing climate data could take hours, days, or even weeks due to the sheer size of the datasets and limited computational resources. Technology advancements have made this procedure faster and more efficient. The emergence of powerful computing equipment and adaptable programming languages such as Python has greatly reduced computation times, making climate data analysis more accessible and efficient.\n\nClimate data is often released in the form of NetCDF (Network Common Data Form) files, a widely-used format in climate science for storing large, multidimensional datasets. For example, reanalysis datasets like ERA5, produced by the [European Centre for Medium-Range Weather Forecasts (ECMWF)](https://www.ecmwf.int/), are distributed in NetCDF format. Similarly, future climate projections from the [Coupled Model Intercomparison Project Phase 6 (CMIP6)](https://pcmdi.llnl.gov/CMIP6/) are also provided as NetCDF files.\n\nNetCDF files are designed with a structure that allows the storage of multiple variables (e.g., temperature, precipitation, humidity), each of which can have several dimensions — typically time, latitude, longitude and pressure level. This structure is highly efficient for managing large datasets, as it allows for easy access to specific variables or subsets of the data. Figure 1 below illustrates a typical NetCDF file structure, showing how variables like temperature and precipitation are organized along the axes of time, latitude, and longitude.\n\n![Figure 1: Simple structure of NetCDF file](Fig1.webp)\n\n## **Reading NetCDF files with Python**\n\nNumerous libraries are available for reading NetCDF files, but xarray stands out as the most popular choice. It provides a wide array of functions for manipulating climate data efficiently. Thanks to its integration with NumPy and Pandas, xarray offers considerable speed and flexibility, making it an essential tool for climate data analysis in Python.\n\nIn this example, I will demonstrate using output files from a [Global Circulation Model (GCM)](https://en.wikipedia.org/wiki/General_circulation_model). Specifically, I will show the precipitation output from the [ACCESS-CM2](https://research.csiro.au/access/about/cm2/) model, covering the period from *2015* to *2151* under the *SSP5–8.5* scenario.\n\nTo get started, we need to ensure that [xarray](https://docs.xarray.dev/en/stable/) is installed on our system. In this example, I will show in a [Jupyter Notebook](https://jupyter.org/) environment.\n\n```{python}\n#| eval: false\n!pip install xarray\n```\n\nOnce installed, we can import the library just like any other Python library.\n\n```{python}\n#| eval: false\nimport xarray as xr\n```\n\nNetCDF files can be read individually or all at once using functions provided by xarray.\n\nTo read NetCDF files individually, we can use the following script:\n\n```{python}\n#| eval: false\nds = xr.open_dataset(\"file_directory\\pr_day_ACCESS-CM2_ssp585_r1i1p1f1_gn_20150101-20641231.nc\")\n```\n\nHowever, some outputs may be provided in separate files corresponding to specific periods. While we can read them all at once, it’s important that these files are stored in the same folder.\n```{python}\n#| eval: false\nds = xr.open_mfdataset(\"folder_directory\\*.nc\")\n```\n\nThe overview of the file that we read is shown in Figure 2.\n\n![Figure 2: Overview of NetCDF file read by xarray](Fig2.webp)\n\nReferring to **Figure 2**, we can observe that this dataset encompasses *49,673* days, covering the period from ***January 1, 2015***, to ***December 31, 2150***. It includes a total of *14,976* grids, represented by a grid structure of *144 latitude* and *192 longitude* points. The precipitation data is indicated by the variable **pr**.\n\n## **Simple Data Manipulation**\n\n### Data Selection\n\nLet’s get started with a simple manipulation. If we need data for a specific period (let’s say from 2015 to 2020 in this example), we can easily select it from the file using the following script:\n\n```{python}\n#| eval: false\nd15_20 = ds.sel(time = slice(\"2015\", \"2020\"))\n```\n\nThe script above allows us to select data from January 1, 2015, to December 31, 2020. However, if we need data for specific dates, we can easily achieve this by adding the desired dates in the format “yyyy-mm-dd”.\n\n```{python}\n#| eval: false\nd15_20 = ds.sel(time = slice(\"2015-01-01\", \"2020-12-31\"))\n```\n\nIt’s not just time that we can filter; this approach can be applied to all dimensions. For example, if we need data for a specific grid (a pair of latitude (-89.375) and longitude (0.9375) coordinates), we can also use the .sel() function to extract that information.\n\n```{python}\n#| eval: false\nds_latlon = ds.sel(lat = -89.375, lon = 0.9375)\n```\n\n## Simple Calculations: Mean, Min, Max, and Conversion to DataFrame\n\nIn climate studies, particularly those related to precipitation, several common indices are used to gain insights from the data. For each grid, we can calculate indices such as the maximum daily precipitation (Rx1day), minimum daily precipitation (Rn1day), and the mean precipitation using functions provided by xarray. These calculations can be separated into individual datasets for easier analysis.\n\nFor Rx1day, we can obtain it by:\n\n```{python}\n#| eval: false\nds['time'] = ds['time'].dt.year\n\nrx1day = ds.groupby('time').max(dim='time')\n```\n\nRn1day:\n\n```{python}\n#| eval: false\nrn1day = ds.groupby('time').min(dim='time')\n```\n\nMean:\n\n```{python}\n#| eval: false\nmean_pr = ds.groupby('time').mean(dim='time')\n```\n\nThese datasets are summarized in Figure 3.\n\n![Figure 3: Overview of selected Rx1day ds](Fig3.webp)\n\n### Converting to Pandas DataFrame\n\nThe Pandas DataFrame (hereafter referred to as *df*) is one of the most powerful tools for data analysis, offering numerous functions to manipulate and visualize data effectively. However, it is not recommended to convert large datasets into a DataFrame, as this can consume a significant amount of memory.\n\nTo convert a ds into a Pandas DataFrame df, we can simply use the *.to_dataframe()* function provided by xarray.\n\n\n```{python}\n#| eval: false\nrx1day_df = rx1day.to_dataframe()\n```\n\n![Figure 4: Overview of rx1day_df](Fig4.webp)","srcMarkdownNoYaml":"\n## **Introduction to Climate Data**\n\nWith the evolution of computational technology, climate studies have greatly benefited from these advancements. In the past, analyzing climate data could take hours, days, or even weeks due to the sheer size of the datasets and limited computational resources. Technology advancements have made this procedure faster and more efficient. The emergence of powerful computing equipment and adaptable programming languages such as Python has greatly reduced computation times, making climate data analysis more accessible and efficient.\n\nClimate data is often released in the form of NetCDF (Network Common Data Form) files, a widely-used format in climate science for storing large, multidimensional datasets. For example, reanalysis datasets like ERA5, produced by the [European Centre for Medium-Range Weather Forecasts (ECMWF)](https://www.ecmwf.int/), are distributed in NetCDF format. Similarly, future climate projections from the [Coupled Model Intercomparison Project Phase 6 (CMIP6)](https://pcmdi.llnl.gov/CMIP6/) are also provided as NetCDF files.\n\nNetCDF files are designed with a structure that allows the storage of multiple variables (e.g., temperature, precipitation, humidity), each of which can have several dimensions — typically time, latitude, longitude and pressure level. This structure is highly efficient for managing large datasets, as it allows for easy access to specific variables or subsets of the data. Figure 1 below illustrates a typical NetCDF file structure, showing how variables like temperature and precipitation are organized along the axes of time, latitude, and longitude.\n\n![Figure 1: Simple structure of NetCDF file](Fig1.webp)\n\n## **Reading NetCDF files with Python**\n\nNumerous libraries are available for reading NetCDF files, but xarray stands out as the most popular choice. It provides a wide array of functions for manipulating climate data efficiently. Thanks to its integration with NumPy and Pandas, xarray offers considerable speed and flexibility, making it an essential tool for climate data analysis in Python.\n\nIn this example, I will demonstrate using output files from a [Global Circulation Model (GCM)](https://en.wikipedia.org/wiki/General_circulation_model). Specifically, I will show the precipitation output from the [ACCESS-CM2](https://research.csiro.au/access/about/cm2/) model, covering the period from *2015* to *2151* under the *SSP5–8.5* scenario.\n\nTo get started, we need to ensure that [xarray](https://docs.xarray.dev/en/stable/) is installed on our system. In this example, I will show in a [Jupyter Notebook](https://jupyter.org/) environment.\n\n```{python}\n#| eval: false\n!pip install xarray\n```\n\nOnce installed, we can import the library just like any other Python library.\n\n```{python}\n#| eval: false\nimport xarray as xr\n```\n\nNetCDF files can be read individually or all at once using functions provided by xarray.\n\nTo read NetCDF files individually, we can use the following script:\n\n```{python}\n#| eval: false\nds = xr.open_dataset(\"file_directory\\pr_day_ACCESS-CM2_ssp585_r1i1p1f1_gn_20150101-20641231.nc\")\n```\n\nHowever, some outputs may be provided in separate files corresponding to specific periods. While we can read them all at once, it’s important that these files are stored in the same folder.\n```{python}\n#| eval: false\nds = xr.open_mfdataset(\"folder_directory\\*.nc\")\n```\n\nThe overview of the file that we read is shown in Figure 2.\n\n![Figure 2: Overview of NetCDF file read by xarray](Fig2.webp)\n\nReferring to **Figure 2**, we can observe that this dataset encompasses *49,673* days, covering the period from ***January 1, 2015***, to ***December 31, 2150***. It includes a total of *14,976* grids, represented by a grid structure of *144 latitude* and *192 longitude* points. The precipitation data is indicated by the variable **pr**.\n\n## **Simple Data Manipulation**\n\n### Data Selection\n\nLet’s get started with a simple manipulation. If we need data for a specific period (let’s say from 2015 to 2020 in this example), we can easily select it from the file using the following script:\n\n```{python}\n#| eval: false\nd15_20 = ds.sel(time = slice(\"2015\", \"2020\"))\n```\n\nThe script above allows us to select data from January 1, 2015, to December 31, 2020. However, if we need data for specific dates, we can easily achieve this by adding the desired dates in the format “yyyy-mm-dd”.\n\n```{python}\n#| eval: false\nd15_20 = ds.sel(time = slice(\"2015-01-01\", \"2020-12-31\"))\n```\n\nIt’s not just time that we can filter; this approach can be applied to all dimensions. For example, if we need data for a specific grid (a pair of latitude (-89.375) and longitude (0.9375) coordinates), we can also use the .sel() function to extract that information.\n\n```{python}\n#| eval: false\nds_latlon = ds.sel(lat = -89.375, lon = 0.9375)\n```\n\n## Simple Calculations: Mean, Min, Max, and Conversion to DataFrame\n\nIn climate studies, particularly those related to precipitation, several common indices are used to gain insights from the data. For each grid, we can calculate indices such as the maximum daily precipitation (Rx1day), minimum daily precipitation (Rn1day), and the mean precipitation using functions provided by xarray. These calculations can be separated into individual datasets for easier analysis.\n\nFor Rx1day, we can obtain it by:\n\n```{python}\n#| eval: false\nds['time'] = ds['time'].dt.year\n\nrx1day = ds.groupby('time').max(dim='time')\n```\n\nRn1day:\n\n```{python}\n#| eval: false\nrn1day = ds.groupby('time').min(dim='time')\n```\n\nMean:\n\n```{python}\n#| eval: false\nmean_pr = ds.groupby('time').mean(dim='time')\n```\n\nThese datasets are summarized in Figure 3.\n\n![Figure 3: Overview of selected Rx1day ds](Fig3.webp)\n\n### Converting to Pandas DataFrame\n\nThe Pandas DataFrame (hereafter referred to as *df*) is one of the most powerful tools for data analysis, offering numerous functions to manipulate and visualize data effectively. However, it is not recommended to convert large datasets into a DataFrame, as this can consume a significant amount of memory.\n\nTo convert a ds into a Pandas DataFrame df, we can simply use the *.to_dataframe()* function provided by xarray.\n\n\n```{python}\n#| eval: false\nrx1day_df = rx1day.to_dataframe()\n```\n\n![Figure 4: Overview of rx1day_df](Fig4.webp)"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"jupyter"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","theme":"flat","title-block-banner":true,"title":"A Beginner’s Guide to Climate Data Analysis with Python: NetCDF, xarray","author":"Min Sothearith","date":"2025-03-15","categories":["Climate Data"],"image":"image.webp"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}